<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservar Turno | ReservaLink</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            color: #1e293b;
            overflow-x: hidden;
        }

        /* Glassmorphism Styles */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
        }

        /* 3D Tilt Effect Base */
        .glass-card-hover {
            transform-style: preserve-3d;
            transform: perspective(1000px);
        }

        /* Custom Date Cells generated by JS */
        .date-cell {
            transition: all 0.2s ease;
            border-radius: 0.75rem;
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 0.875rem;
            position: relative;
        }
        .date-cell:hover:not(:disabled) {
            background-color: #eef2ff;
            color: #4f46e5;
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.1);
        }
        .date-cell.selected-date {
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%) !important;
            color: white !important;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
            transform: scale(1.05);
            border: none !important;
        }
        .date-cell.today {
            border: 2px solid #6366f1;
            color: #4f46e5;
            font-weight: 700;
        }
        .date-cell.today.selected-date {
            border: 2px solid white;
            color: white;
        }
        .date-cell:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* Availability Dot */
        .date-cell.available::after {
            content: '';
            position: absolute;
            bottom: 6px;
            width: 4px;
            height: 4px;
            background-color: #4f46e5;
            border-radius: 50%;
        }
        .date-cell.available.selected-date::after {
            background-color: white;
        }

        /* Time Slot Buttons */
        .slot-time-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .slot-time-btn.selected {
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%) !important;
            color: white !important;
            border-color: transparent !important;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            transform: scale(1.02);
        }

        /* Loading Animation */
        .loader-dots div {
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }
        .loader-dots div:nth-child(1) { left: 8px; animation: loader-dots1 0.6s infinite; }
        .loader-dots div:nth-child(2) { left: 8px; animation: loader-dots2 0.6s infinite; }
        .loader-dots div:nth-child(3) { left: 32px; animation: loader-dots2 0.6s infinite; }
        .loader-dots div:nth-child(4) { left: 56px; animation: loader-dots3 0.6s infinite; }
        @keyframes loader-dots1 { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes loader-dots3 { 0% { transform: scale(1); } 100% { transform: scale(0); } }
        @keyframes loader-dots2 { 0% { transform: translate(0, 0); } 100% { transform: translate(24px, 0); } }
    </style>
</head>
<body class="min-h-screen relative selection:bg-indigo-500 selection:text-white">

<!-- Background Blobs -->
<div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-300 rounded-full mix-blend-multiply filter blur-[128px] opacity-40 animate-blob"></div>
    <div class="absolute top-0 right-1/4 w-96 h-96 bg-indigo-300 rounded-full mix-blend-multiply filter blur-[128px] opacity-40 animate-blob animation-delay-2000"></div>
    <div class="absolute -bottom-32 left-1/2 w-96 h-96 bg-pink-300 rounded-full mix-blend-multiply filter blur-[128px] opacity-40 animate-blob animation-delay-4000"></div>
</div>

<!-- Navbar -->
<nav class="fixed w-full z-50 top-0 glass-panel border-b-0 border-b-white/20 h-20 flex items-center">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 p-2 rounded-xl shadow-lg shadow-indigo-500/30">
                    <i data-lucide="calendar-check-2" class="w-6 h-6 text-white"></i>
                </div>
                <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600">ReservaLink</h1>
            </div>
            <!--<div class="hidden sm:block text-xs font-medium text-indigo-600 bg-indigo-50 px-3 py-1.5 rounded-full border border-indigo-100">
                <i data-lucide="shield-check" class="w-3 h-3 inline mr-1"></i> Reserva Segura
            </div>-->
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="relative z-10 pt-28 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto min-h-screen flex flex-col">

    <!-- Dynamic Profile Header (Shows when in Services View) -->
    <div id="profileHeader" class="text-center mb-12 animate-fade-in transition-all duration-500">
        <!--  <div class="inline-flex items-center justify-center w-24 h-24 rounded-3xl bg-gradient-to-br from-indigo-500 to-purple-600 text-white text-3xl font-bold shadow-xl shadow-indigo-500/20 mb-6 border-[6px] border-white transform hover:scale-105 transition-transform duration-300">
              <span id="profileInitials">DR</span>
          </div>-->
          <h2 class="text-4xl font-bold text-gray-900 mb-3 tracking-tight">Reserva tu turno</h2>
          <p class="text-lg text-gray-600 max-w-2xl mx-auto leading-relaxed">Seleccioná el servicio para encontrar el horario perfecto en segundos.</p>
      </div>

      <!-- Loading State -->
    <div id="loadingState" class="flex-1 flex flex-col items-center justify-center min-h-[400px]">
        <div class="loader-dots relative w-20 h-5"><div></div><div></div><div></div><div></div></div>
        <p class="text-indigo-500 mt-6 font-medium animate-pulse">Cargando disponibilidad...</p>
    </div>

    <!-- Error State -->
    <div id="errorState" class="hidden flex-1 flex flex-col items-center justify-center min-h-[400px] animate-fade-in">
        <div class="glass-panel p-8 rounded-3xl text-center max-w-md border-red-100">
            <div class="w-16 h-16 bg-red-50 text-red-500 rounded-2xl flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-circle" class="w-8 h-8"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Ups, algo salió mal</h3>
            <p class="text-gray-600 text-sm mb-6">No pudimos cargar los servicios. Por favor verifica el enlace o intenta más tarde.</p>
            <button onclick="window.location.reload()" class="px-6 py-2 bg-white border border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors">Recargar página</button>
        </div>
    </div>

    <!-- No Services State -->
    <div id="noServicesState" class="hidden flex-1 flex flex-col items-center justify-center min-h-[400px] animate-fade-in">
        <div class="glass-panel p-8 rounded-3xl text-center max-w-md border-yellow-100">
            <div class="w-16 h-16 bg-yellow-50 text-yellow-600 rounded-2xl flex items-center justify-center mx-auto mb-6">
                <i data-lucide="calendar-off" class="w-8 h-8"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Sin servicios activos</h3>
            <p class="text-gray-600 text-sm">Este profesional no tiene servicios disponibles para reservar en este momento.</p>
        </div>
    </div>

    <!-- 1. Services Grid -->
    <div id="servicesContainer" class="hidden w-full">
        <div id="servicesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Cards injected via JS with 3D Tilt styles -->
        </div>
    </div>

    <!-- 2. Booking Panel (Hidden by default) -->
    <div id="bookingPanel" class="hidden animate-slide-up w-full">

        <button id="backToServicesBtn" class="group flex items-center text-gray-500 hover:text-indigo-600 font-medium transition-colors mb-8 px-5 py-2.5 rounded-full bg-white/40 hover:bg-white border border-white/60 w-fit backdrop-blur-sm shadow-sm">
            <i data-lucide="arrow-left" class="w-4 h-4 mr-2 group-hover:-translate-x-1 transition-transform"></i>
            Volver a servicios
        </button>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- Left: Calendar & Slots (8 cols) -->
            <div class="lg:col-span-7 xl:col-span-8 space-y-6">

                <!-- Calendar Card -->
                <div class="glass-panel rounded-[2rem] p-6 sm:p-8">
                    <div class="flex items-center justify-between mb-8">
                        <h3 class="text-xl font-bold text-gray-900 flex items-center gap-3">
                            <div class="p-2 bg-indigo-100 rounded-lg text-indigo-600">
                                <i data-lucide="calendar" class="w-5 h-5"></i>
                            </div>
                            Selecciona Fecha
                        </h3>

                        <!-- Month Navigation -->
                        <div class="flex items-center bg-gray-50/80 p-1.5 rounded-2xl border border-gray-100">
                            <button id="prevMonthBtn" class="p-2 hover:bg-white hover:shadow-sm rounded-xl transition-all text-gray-600">
                                <i data-lucide="chevron-left" class="w-5 h-5"></i>
                            </button>
                            <span id="currentMonthYear" class="px-4 font-semibold text-gray-800 min-w-[140px] text-center text-sm sm:text-base capitalize">...</span>
                            <button id="nextMonthBtn" class="p-2 hover:bg-white hover:shadow-sm rounded-xl transition-all text-gray-600">
                                <i data-lucide="chevron-right" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Calendar Grid -->
                    <div class="grid grid-cols-7 text-center mb-4">
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider py-2">Lun</span>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider py-2">Mar</span>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider py-2">Mié</span>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider py-2">Jue</span>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider py-2">Vie</span>
                        <span class="text-xs font-bold text-indigo-500 uppercase tracking-wider py-2">Sáb</span>
                        <span class="text-xs font-bold text-indigo-500 uppercase tracking-wider py-2">Dom</span>
                    </div>

                    <div id="calendarGrid" class="grid grid-cols-7 gap-2 sm:gap-3">
                        <!-- Date Cells injected here -->
                    </div>
                    <p id="dateMessage" class="text-center text-sm text-gray-500 mt-6 hidden animate-pulse">
                        <span class="inline-block w-2 h-2 bg-indigo-500 rounded-full mr-2 animate-bounce"></span>
                        Cargando disponibilidad...
                    </p>
                </div>

                <!-- Slots Section -->
                <div id="slotsSection" class="glass-panel rounded-[2rem] p-6 sm:p-8 transition-all duration-500">
                    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                        <div class="p-2 bg-indigo-100 rounded-lg text-indigo-600">
                            <i data-lucide="clock" class="w-5 h-5"></i>
                        </div>
                        Horarios disponibles
                    </h3>

                    <div id="slotTimeContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 max-h-64 overflow-y-auto pr-2 custom-scrollbar">
                        <!-- Slots injected here -->
                        <div class="col-span-full text-center py-10 text-gray-400 flex flex-col items-center border-2 border-dashed border-gray-200 rounded-2xl">
                            <i data-lucide="mouse-pointer-click" class="w-8 h-8 mb-3 opacity-40"></i>
                            <p>Selecciona un día en el calendario para ver los horarios.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Form (4 cols) -->
            <div class="lg:col-span-5 xl:col-span-4">
                <div class="sticky top-24 space-y-6">

                    <!-- Summary Card -->
                    <div class="glass-panel rounded-[2rem] p-1 bg-gradient-to-br from-white to-indigo-50/50 border-indigo-100">
                        <div class="p-6">
                            <div id="selectedServiceInfo">
                                <!-- Service Info injected here -->
                            </div>

                            <div id="slotPriceDisplay" class="mt-6 pt-6 border-t border-indigo-100/50 hidden">
                                <!-- Dynamic Price injected here -->
                            </div>
                        </div>
                    </div>

                    <!-- Form -->
                    <div class="glass-panel rounded-[2rem] p-6 sm:p-8">
                        <h4 class="font-bold text-gray-900 mb-6 flex items-center gap-2">
                            <i data-lucide="user-check" class="w-5 h-5 text-gray-400"></i>
                            Tus datos
                        </h4>

                        <form id="bookingForm" class="space-y-5">
                            <input type="hidden" id="slotTimeId" name="slotTimeId" required>

                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide ml-1">Nombre Completo</label>
                                <div class="relative group">
                                    <i data-lucide="user" class="absolute left-4 top-3.5 w-5 h-5 text-gray-400 group-focus-within:text-indigo-500 transition-colors"></i>
                                    <input type="text" id="name" name="name" required
                                           class="w-full pl-12 pr-4 py-3 bg-white/60 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all placeholder-gray-400"
                                           placeholder="Ej: Juan Pérez">
                                </div>
                            </div>

                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide ml-1">Email</label>
                                <div class="relative group">
                                    <i data-lucide="mail" class="absolute left-4 top-3.5 w-5 h-5 text-gray-400 group-focus-within:text-indigo-500 transition-colors"></i>
                                    <input type="email" id="email" name="email" required
                                           class="w-full pl-12 pr-4 py-3 bg-white/60 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all placeholder-gray-400"
                                           placeholder="juan@ejemplo.com">
                                </div>
                            </div>

                            <div class="space-y-1.5">
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide ml-1">Teléfono</label>
                                <div class="relative group">
                                    <i data-lucide="phone" class="absolute left-4 top-3.5 w-5 h-5 text-gray-400 group-focus-within:text-indigo-500 transition-colors"></i>
                                    <input type="tel" id="phoneNumber" name="phoneNumber" required
                                           class="w-full pl-12 pr-4 py-3 bg-white/60 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all placeholder-gray-400"
                                           placeholder="+54 9 11...">
                                </div>
                            </div>

                            <div id="quantityContainer" class="hidden space-y-1.5 animate-fade-in">
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide ml-1">Cantidad de Personas</label>
                                <div class="relative group">
                                    <i data-lucide="users" class="absolute left-4 top-3.5 w-5 h-5 text-gray-400 group-focus-within:text-indigo-500 transition-colors"></i>
                                    <input type="number" id="quantity" name="quantity" value="1" min="1"
                                           class="w-full pl-12 pr-4 py-3 bg-white/60 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all">
                                </div>
                            </div>

                            <button type="submit" id="submitBookingBtn" disabled
                                    class="w-full py-4 px-6 bg-gray-900 text-white font-bold rounded-xl shadow-xl shadow-gray-900/10 hover:shadow-gray-900/20 hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:transform-none flex justify-center items-center gap-2 mt-6 group">
                                <span>Confirmar Reserva</span>
                                <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
                            </button>
                        </form>
                    </div>

                </div>
            </div>

        </div>
    </div>

</main>

<!-- Config (Mock) -->
<script src="../commons/config.js"></script>

<!-- Logic -->
<script src="./js/userOfferings.js"></script>

<!-- 3D Tilt Logic for Services Cards -->
<script>
    function initTilt() {
        const cards = document.querySelectorAll('.glass-card-hover');
        cards.forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = ((y - centerY) / centerY) * -2; // Subtle rotation
                const rotateY = ((x - centerX) / centerX) * 2;
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.01, 1.01, 1.01)`;
            });
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)';
            });
        });
    }
    // Expose to window so JS file can call it after render
    window.initTilt = initTilt;
</script>
</body>
</html>